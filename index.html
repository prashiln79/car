<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MQTT Car Control</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; height: 100vh;
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  margin: 0;
}
h2 { color: #333; margin-bottom: 20px; text-align: center; }

.hud {
  color: #333; font-size: 14px; margin-bottom: 10px; text-align: center;
}

.controls {
  display: grid;
  grid-template-areas:
    ". forward ."
    "left stop right"
    ". backward .";
  gap: 15px;
  justify-content: center;
  align-items: center;
}

#forward { grid-area: forward; }
#backward { grid-area: backward; }
#left { grid-area: left; }
#right { grid-area: right; }
#stop { grid-area: stop; }

button {
  width: 120px; height: 80px;
  font-size: 18px; font-weight: 600;
  border: none; border-radius: 16px;
  background-color: #4CAF50; color: white;
  box-shadow: 0 6px #388E3C;
  transition: 0.15s ease;
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
button:active { transform: scale(0.96); }
#stop { background-color: #f44336; box-shadow: 0 6px #c62828; }

@media (max-width: 600px) {
  h2 { font-size: 22px; margin-bottom: 15px; }
  .hud { font-size: 13px; }
  button {
    width: 28vw; height: 72px; font-size: 16px;
    border-radius: 14px;
  }
  #stop { width: 28vw; }
  .controls { gap: 10px; }
}
</style>
</head>
<body>
  <h2>ðŸš— MQTT WiFi Car Control</h2>
  <div class="hud">Touch and hold to move. Release to stop.</div>

  <div class="controls">
    <button id="forward">Forward</button>
    <button id="backward">Backward</button>
    <button id="left">Left</button>
    <button id="right">Right</button>
    <button id="stop">Stop</button>
  </div>

<script>
// ===== MQTT CONFIG =====
const options = {
  username: "Prashil",
  password: "Prashil@n79",
  clean: true,
  connectTimeout: 4000,
  reconnectPeriod: 2000
};

// Connect to HiveMQ Cloud using WSS
const client = mqtt.connect("wss://f31f59e872194305880111b99a249d12.s1.eu.hivemq.cloud:8884/mqtt", options);

client.on("connect", () => {
  console.log("âœ… Connected to HiveMQ Cloud");
  client.subscribe("car/status", err => {
    if (!err) console.log("ðŸ“¡ Subscribed to car/status");
  });
});

client.on("message", (topic, message) => {
  console.log(`ðŸ“© ${topic}: ${message.toString()}`);
});

client.on("error", err => console.error("âŒ MQTT Error:", err));

// ===== COMMAND SEND =====
function send(cmd) {
  console.log(`ðŸš€ Sending: ${cmd}`);
  client.publish("car/control", cmd);
}
function stop() { send("stop"); }

function vibrate(ms) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

// ===== BUTTON CONTROLS =====
const buttons = ["forward","backward","left","right"];
buttons.forEach(id => {
  const btn = document.getElementById(id);

  // Desktop: Mouse control
  btn.onmousedown = () => { vibrate(15); send(id); };
  btn.onmouseup = stop;
  btn.onmouseleave = stop;

  // Mobile: Touch control
  btn.ontouchstart = e => { e.preventDefault(); vibrate(20); send(id); };
  btn.ontouchend = e => { e.preventDefault(); vibrate(25); stop(); };
});

const stopBtn = document.getElementById("stop");
stopBtn.onclick = () => { vibrate(40); stop(); };
stopBtn.ontouchend = e => { e.preventDefault(); vibrate(40); stop(); };

// ===== KEYBOARD SUPPORT =====
const keyMap = {
  ArrowUp: "forward", KeyW: "forward",
  ArrowDown: "backward", KeyS: "backward",
  ArrowLeft: "left", KeyA: "left",
  ArrowRight: "right", KeyD: "right"
};
let activeKey = null;

document.addEventListener("keydown", e => {
  const cmd = keyMap[e.code];
  if (!cmd || cmd === activeKey) return;
  activeKey = cmd; vibrate(10); send(cmd);
});
document.addEventListener("keyup", e => {
  if (keyMap[e.code]) { activeKey = null; vibrate(15); stop(); }
});
</script>
</body>
</html>
