<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MQTT Car Control</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body {
  font-family: Arial;
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; height: 100vh;
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
}
h2 { color: #333; margin-bottom: 20px; }
.controls {
  display: grid;
  grid-template-areas: ". forward ."
                       "left stop right"
                       ". backward .";
  gap: 15px;
}
button {
  width: 110px; height: 70px;
  font-size: 18px; border: none; border-radius: 12px;
  background-color: #4CAF50; color: white;
  box-shadow: 0 4px #388E3C; transition: 0.1s;
}
button:active { transform: translateY(3px); }
#stop { background-color: #f44336; }
</style>
</head>
<body>
  <h2>ðŸš— MQTT WiFi Car Control</h2>
  <div class="controls">
    <button id="forward">Forward</button>
    <button id="backward">Backward</button>
    <button id="left">Left</button>
    <button id="right">Right</button>
    <button id="stop">Stop</button>
  </div>

<script>
const options = {
  username: "Prashil",  
  password: "Prashil@n79", 
  clean: true,
  connectTimeout: 4000,
  reconnectPeriod: 2000
};

// Use WebSocket Secure port (8884)
const client = mqtt.connect("wss://f31f59e872194305880111b99a249d12.s1.eu.hivemq.cloud:8884/mqtt", options);

client.on("connect", () => {
  console.log("âœ… Connected to HiveMQ Cloud");
  client.subscribe("car/status", (err) => {
    if (!err) console.log("ðŸ“¡ Subscribed to car/status");
  });
});

client.on("message", (topic, message) => {
  console.log(`ðŸ“© ${topic}: ${message.toString()}`);
});

client.on("error", (err) => console.error("âŒ Connection error", err));

function send(cmd) {
  client.publish("car/control", cmd);
}

function stop() { send("stop"); }

["forward","backward","left","right","stop"].forEach(id=>{
 const b=document.getElementById(id);
 if(id==="stop"){b.onclick=stop;return;}
 b.onmousedown=()=>send(id);b.onmouseup=stop;b.onmouseleave=stop;
 b.ontouchstart=e=>{e.preventDefault();send(id);}
 b.ontouchend=e=>{e.preventDefault();stop();}
});
</script>
</body>
</html>
